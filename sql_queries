
-- Walmart Sales Data Analysis SQL Queries

- Top Performing Cities.
    ```sq
    SELECT 
	    city, 
      SUM(total) as total_sales
    FROM 
    walmart
    GROUP BY city
    ORDER BY total_sales DESC
    LIMIT 3;
    ```


- Category Sales Share
    ```sq
    SELECT
      category, 
      SUM(total) as category_total_sales, 
      (SUM(total) * 100) / SUM(SUM(total)) OVER() as category_percent_share
    FROM
    walmart
    GROUP BY category
    ORDER BY category_percent_share DESC;
    ```


- Identify 5 branch with highest decrease ratio in revenue 
-- compare to last year (current year 2023 and last year 2022)
    ```sq  
    WITH revenue_2022 AS
    (SELECT 
      branch, 
      city,
      SUM(total) as revenue
    FROM walmart
    WHERE YEAR(STR_TO_DATE(date, '%d/%m/%y')) = 2022
    GROUP BY branch, city), 

    revenue_2023 AS
    (SELECT 
      branch,
      city, 
      SUM(total) as revenue
    FROM walmart
    WHERE YEAR(STR_TO_DATE(date, '%d/%m/%y')) = 2023
    GROUP BY branch, city)

    SELECT 
      ls.branch,
      ls.city,
      ls.revenue as last_year_revenue,
      cs.revenue as current_year_revenue,
      ROUND(((CAST(ls.revenue AS DECIMAL) - CAST(cs.revenue AS DECIMAL)) 
                / CAST(ls.revenue AS DECIMAL)* 100)) as ratio
    FROM revenue_2022 as ls
    JOIN
    revenue_2023 as cs
    ON ls.branch = cs.branch
    WHERE ls.revenue > cs.revenue
    ORDER BY ratio DESC
    LIMIT 5;
    ```


- Monthly/Quarterly Sales Trend
-- Monthly
    ```sq
    SELECT
      SUM(total) as monthly_sales, 
      DATE_FORMAT(STR_TO_DATE(date, '%d/%m/%y'), '%Y-%m') as sales_year_month
    FROM
    walmart
    WHERE DATE_FORMAT(STR_TO_DATE(date, '%d/%m/%y'), '%Y') = '2023'
    GROUP BY sales_year_month
    ORDER BY sales_year_month DESC;
    ```


- Categorize sales into 3 group MORNING, AFTERNOON, EVENING
    ```sq 
    SELECT
      branch, 
      CASE 
        WHEN HOUR(time) < 12 THEN 'Morning'
        WHEN HOUR(time) >= 12 AND HOUR(time) < 18 THEN 'Afternoon'
        ELSE 'Evening'
      END day_time, 
      COUNT(*) as no_of_invoices
    FROM walmart
    GROUP BY branch, day_time
    ORDER BY  branch, no_of_invoices DESC;
    ```


- Identify the busiest day for each branch based on the number of transactions
    ```sq 
    WITH cte as 
    (SELECT
      branch, 
      DAYNAME(STR_TO_DATE(date, '%d/%m/%y')) AS day_name, 
      COUNT(*) as no_of_transactions,
      RANK() OVER(PARTITION BY branch ORDER BY COUNT(*) DESC) as ranking
    FROM walmart
    GROUP BY branch, day_name)
    SELECT * FROM cte
    WHERE ranking = 1;
    ```

- Branch with the average highest transaction value
    ```sq
    SELECT
      branch, 
      city,
      AVG(total) as avg_total
    FROM
    walmart
    GROUP BY branch, city
    ORDER BY avg_total DESC;
    ```

- Identify the highest-rated category in each branch, displaying the branch, category
    ```sq
    WITH cte as
    (SELECT
      branch, 
      category, 
      AVG(rating) as avg_rating,
      RANK() OVER(PARTITION BY branch ORDER BY AVG(rating) DESC) as ranks
    FROM walmart
    GROUP BY branch, category)
    SELECT * FROM cte
    WHERE ranks  = 1;
    ```


- Rating by Category
    ```sq 
    SELECT
      category, 
      AVG(rating) as avg_rating
    FROM
    walmart
    GROUP BY category
    ORDER BY avg_rating DESC;
    ```


- Low-Rated Transactions
    ```sq 
    SELECT
      invoice_ID,
      city,
      category, 
      rating,
      total
    FROM
    walmart
    WHERE rating < (SELECT AVG(rating) FROM walmart)
    ORDER BY rating, total DESC;
    ```


- Overrall Top Categories for all stores
    ```sq 
    SELECT
      category, 
      SUM(quantity) as total_quantity_sold
    FROM
    walmart
    GROUP BY category
    ORDER BY total_quantity_sold DESC
    LIMIT 3;
    ```


- Sales Distribution by Payment
    ```sq 
    SELECT
      payment_method, 
      SUM(total) as total_revenue, 
      SUM(quantity) as quantity_sold, 
      COUNT(*) as no_of_transactions
    FROM 
    walmart
    GROUP BY payment_method
    ORDER BY total_revenue DESC;
    ```

- High-Value vs. Low-Value Items:
-- High-Value
    ```sq 
    SELECT
      category, 
      AVG(unit_price) as category_avg_price
    FROM 
    walmart
    GROUP BY category
    HAVING category_avg_price > (
    SELECT
      AVG(unit_price) 
    FROM 
    walmart)
    ORDER BY category_avg_price DESC;
    ```

-- low value item
    ```sq 
    SELECT
      category, 
      AVG(unit_price) as category_avg_price
    FROM 
    walmart
    GROUP BY category
    HAVING category_avg_price < (
    SELECT
      AVG(unit_price) 
    FROM 
    walmart)
    ORDER BY category_avg_price DESC;
    ```







    


    
      


